# Claude Code Prompt for Booking Agent Implementation

I need to replace the mock accommodation search in my existing Next.js API route with a sophisticated Playwright automation agent that acts as an intelligent booking assistant with AI-powered decision making.

**Current Architecture (KEEP):**
- Server-Sent Events streaming with progress updates
- TravelCriteria input interface
- AccommodationResult output format
- Streaming controller with progress messages and final results

**Replace Mock Logic With:**
1. **Real browser automation** - Navigate booking sites (starting with Booking.com and Airbnb.com) using Playwright
2. **Form interaction** - Fill search forms with criteria.destination, criteria.budget, etc.
3. **Multi-site search strategy** - Search both Booking.com and Airbnb.com for comprehensive coverage, with ability to expand to additional sites (Hotels.com, Expedia) if gaps are found
4. **Hybrid intelligent evaluation** - Rule-based filtering + AI-powered ranking (GPT-3.5-turbo)
5. **Progress streaming** - Update existing progress messages to reflect real automation steps

**Key Integration Points:**
- Replace `getAccommodationsForDestination()` and `filterByBudget()` with real Playwright automation
- Keep the streaming progress updates but make them reflect actual automation progress (e.g., "Navigating to Booking.com...", "Filling search form...", "Evaluating Property 3 of 8...")
- Return results in the enhanced AccommodationResult format
- Maintain the same error handling and streaming response structure
- Handle potential automation failures gracefully with fallback messaging

**Intelligence Architecture:**
- **Rule-based filtering**: Fast elimination based on budget, dates, availability
- **AI evaluation**: Use GPT-3.5-turbo to rank viable properties with reasoning
- **Stream integration**: Send progress updates during each automation phase

**Thoroughness and Timing Expectations:**
The agent should take 10-20 minutes for thorough evaluation, spending 2-3 minutes per property like a careful human reviewer. Prioritize quality and natural browsing patterns over speed. The agent should:
- Search both Booking.com and Airbnb.com for comprehensive coverage of hotels, apartments, and unique stays
- Compare results across platforms for better user options
- Expand to additional sites (Hotels.com, Expedia) only if gaps are identified in coverage or pricing
- Read actual guest reviews for insights
- Evaluate photos and amenity details thoroughly
- Cross-reference locations and nearby attractions
- Use natural pauses between clicks and page loads for realistic browsing
- Focus on evaluating 5-10 properties comprehensively rather than rushing through many

**Technical Requirements:**
- **Headless browser operation:** Run in headless mode for production (invisible to users), with option for headed mode during development
- **Stealth configuration:** Use realistic browser settings, user agents, and viewport sizes
- **Error resilience:** Handle dynamic content loading, popup blockers, and layout changes
- **Data validation:** Ensure extracted data is clean and properly formatted
- **Memory management:** Properly close browser instances and clean up resources
- **Timeout handling:** Set appropriate timeouts for page loads and element interactions
- **Concurrent browsing:** Consider running Booking.com and Airbnb searches simultaneously for efficiency

**Input:** Existing TravelCriteria interface
**Output:** Array of enhanced AccommodationResult objects with the following format:

```typescript
interface AccommodationResult {
  id: string;
  name: string;
  price: number;              // Price per night
  rating: number;             // Decimal rating (e.g., 4.5)
  description: string;        // Property description
  amenities: string[];        // Array of amenity strings
  imageUrl?: string;          // Optional image URL
  location: string;           // Location description
  // Enhanced fields for AI intelligence:
  bookingUrl?: string;        // Direct booking link with pre-filled dates
  aiReasoning?: string;       // AI explanation for why this property was selected
  matchScore?: number;        // Overall match score (0-100) based on user criteria
}
```

Please implement the Playwright automation agent that integrates seamlessly with my existing streaming API route, replacing only the mock search logic while preserving all the SSE streaming infrastructure.

The agent should provide real accommodation results while maintaining the same user experience of progress updates and final results delivery, but with the understanding that the process will take 10-20 minutes for thorough, human-like evaluation.